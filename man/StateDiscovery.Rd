% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/StateDiscovery.R
\name{StateDiscovery}
\alias{StateDiscovery}
\title{Run StateDiscovery}
\usage{
StateDiscovery(
  Statescope,
  max_clusters = 10L,
  n_iter = 10L,
  n_final_iter = 100L,
  min_cophenetic = 0.9,
  Ncores = 1L
)
}
\arguments{
\item{Statescope}{Statescope obj from StatescopeRefinement.}

\item{max_clusters}{maximum allowed states per cell type.}

\item{n_iter}{Number of initial cNMF restarts.}

\item{n_final_iter}{Number of final cNMF restarts.}

\item{min_cophenetic}{Minimum cophenetic coefficient to determine K.}

\item{Ncores}{number of cores to use for paralellization.}
}
\value{
updated Statescope S4 object with states per celltype added
}
\description{
\code{StateDiscovery.R} Discovers states from refined ct-specific gep
}
\examples{
#' ## Load data
data <- scRNAseq::SegerstolpePancreasData()

## subset to 100 genes for example
data <- data[1:100]
## Preprocess data
data$donor <- data$individual
data$label <- data$`cell type`

## remove NA cells
data <- data[, !is.na(data$label)]

## remove duplicates gene names
data <- data[!duplicated(rownames(data)), ]

## remove cells with less than 100 in total cohort
celltypes_to_remove <- names(table(data$label)[(table(data$label) < 100)])
data <- data[, !data$label \%in\% celltypes_to_remove]

data <- normalize_scRNAseq(data)

## Create and normalized pseudobulk from scRNAseq
pseudobulk <- generate_pseudobulk(data)

pseudobulk <- normalize_bulkRNAseq(pseudobulk)

## Measure true cell fractions from pseudobulk
true_fractions <- gather_true_fractions(data)

## Create signature from scRNAseq for deconvolution
signature <- create_signature(data)

## Select genes optimized for deconvolution
selected_genes <- select_genes(data)

## Perform Deconvolution with BLADE, refine gene expression estimates
Statescope <- BLADE_deconvolution(signature, pseudobulk, selected_genes, 1L)
Statescope <- Refinement(Statescope, signature, pseudobulk, 1L)

## Discover states
Statescope <- StateDiscovery(Statescope)

## Look at output
states(Statescope)

}
